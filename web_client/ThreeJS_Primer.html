<html lang="en">
	<head>
		<title>Primer s sencami</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
		<meta charset="UTF-8"><meta>
	</head>
	<body>
            <script  type="module">
                import * as THREE from 'three'
                import { OBJLoader } from './src/OBJLoader.js';
                import { MTLLoader } from './src/MTLLoader.js';
                var renderer = new THREE.WebGLRenderer();
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFShadowMap;

                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);
                var scene = new THREE.Scene();
                var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

                var monkey=null;
                // load a resource


                new MTLLoader().
                    load( 'res/x.mtl', function ( materials ) {
                                                materials.preload();
                                                // noinspection JSUnusedLocalSymbols
					new OBJLoader()
                                                        .setMaterials( materials )
                                                        .load( 'res/x.obj',
                            
                            function ( object ) {
                                monkey=object;
                                monkey.traverse( function ( child ) {//TODO: to rabimo, ker je objekt predstavljen kot hierarhija drugih objektov! 
                                    if ( child instanceof THREE.Mesh ) {
                                        //child.material.map = texture;
                                        console.log("Ime objekta: " + child.name);
                                        child.receiveShadow=true;
                                        child.castShadow = true;
                                    }
                                } );

                                scene.add( object );
                                                        }, 
                            // called when loading is in progresses
                            function ( xhr ) {
                                console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
                            },
                            // called when loading has errors
                            function ( error ) {
                                console.log( 'An error happened' );
                            });
                                    } );



                scene.add(new THREE.AmbientLight(0xffffff, 0.2));
                {//luč, najbolje directional light (sonce), najmanj težav
                    var light = new THREE.DirectionalLight( 0xffffff, 0.5 );
                    light.castShadow = true; 
                    light.position.set( 0, 10, 0 ); 	
                    light.shadow.camera.near = 0.1;
                    light.shadow.camera.far = 1000; 

                    light.shadow.mapSize.width = 512;
                    light.shadow.mapSize.height = 512;

                    scene.add(light);
                }

                /*var cube = new THREE.Mesh(
                    new THREE.BoxGeometry(1, 1, 1), 
                    new THREE.MeshLambertMaterial({ color: 0x00aaff })
                    );
                cube.castShadow=true;
                cube.receiveShadow=true;
                scene.add(cube);*/
                
        

                var cube2 = new THREE.Mesh(
                    new THREE.BoxGeometry(10, 1, 10),
                    new THREE.MeshLambertMaterial({ color: 0xffaaaa })
                );

                
                cube2.castShadow=true;//obvezno za vsak objekt!
                cube2.receiveShadow=true;//obvezno za vsak objekt!

                cube2.position.y=-2;

                
                scene.add(cube2);


                camera.position.z = 5;
                //scene.add(new THREE.DirectionalLight(0xffffff, 0.3));
                //scene.add(new THREE.SpotLight(0xffffff));
                
                var animate = function () {
                    requestAnimationFrame(animate);
                    if(monkey!=null){
                        monkey.castShadow=true;
                        monkey.receiveShadow=true;
                        monkey.rotation.x += 0.01;
                        monkey.rotation.y += 0.01;
                    }
                    renderer.render(scene, camera);
                };
                animate();

            </script>
	</body>
</html>
